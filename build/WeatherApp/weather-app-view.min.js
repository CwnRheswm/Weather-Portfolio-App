define(["jquery","underscore","backbone","../Geocode/geocodes.min","../Geocode/geocodeView.min","../Weather/weathers.min","../Current/currentView.min"],function(a,b,c,d,e,f,g){"use strict";var h="localhost"===window.location.hostname,i=c.View.extend({el:"#weather-app",events:{"keypress #city-search":"checkForEnter","click #current-btn":"validateInput","click #forecast-btn":"validateInput","click #history-btn":"validateInput"},initialize:function(){this.$input=this.$("#city-search"),this.$current=a("#weather-current"),this.geocodes=new d,this.listenTo(this.geocodes,"change:ready",this.addGeocode),this.weathers=new f,this.listenTo(this.weathers,"change:ready",this.addWeather)},render:function(){this.weathers.length?this.$current.show():this.$current.hide()},addWeather:function(a){var b=new g({model:a});this.$current.append(b.render().el)},addGeocode:function(a){var b,c=this.geocodes.models[0];return 1==this.weathers.length?(this.weathers.models[0].set("city",c.get("city")),this.weathers.models[0].set("state",c.get("state")),this.weathers.models[0].set("latitude",Math.round(c.get("latitude"))),this.weathers.models[0].set("longitude",Math.round(c.get("longitude"))),void this.weathers.models[0].sync()):(b=new e({model:a}),void this.weathers.create({city:c.get("city"),state:c.get("state"),latitude:Math.round(c.get("latitude")),longitude:Math.round(c.get("longitude"))}))},retrieveCoordinates:function(a){return 1===this.geocodes.length?(this.geocodes.models[0].set("city",a[0].trim()),this.geocodes.models[0].set("state",a[1].trim()),void this.geocodes.models[0].sync()):void this.geocodes.create({city:a[0].trim(),state:a[1].trim()})},validateInput:function(b){if(a("#weather-current")[0].classList.toggle("opened"),h)return this.$input[0].value="San Fransokyo, CA",this.retrieveCoordinates(["San Fransokyo","CA"]),void b.target.classList.toggle("activated");var c=this.$input.val().trim();if(!c)return void alert("You Need To Enter a City and State first");var d=c.split(",");return 2!==d.length?void alert('Enter The City and State in the form "City, State"'):(b.target.classList.toggle("activated"),void this.retrieveCoordinates(d))},checkForEnter:function(b){b.which===ENTER_KEY&&this.validateInput(a("#current-btn"))}});return i});